<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"/>
	<meta name="viewport" content="width=640, user-scalable=no">
	<meta http-equiv="Cache-Control" content="no-cache">
	<meta name="apple-mobile-web-app-capable" content="yes">
	<title></title>
	<link rel="stylesheet" type="text/css" href="css.css">
</head>
<body>
	<div class="box box1">
		<div class="background1">
			<div class="title1"></div>
			<div class="speakOfMao1"></div>
			<div class="slide"></div>
		</div>
	</div>
	<div class="box box2 hide">
		<div class="background2">
			<div class="speakBackground"></div>
			<div class="speakOfMao2"></div>
			<div class="flagpole"></div>
			<div class="soilders"></div>
			<div class="flag"></div>
			<div class="mao"></div>
			<div class="slide"></div>
		</div>
	</div>
	<div class="box box3 hide">
		<div class="background3">
		</div>
	</div>
	<div class="box box4 hide">
		<div class="background4">
			<div class="sidecurtain"></div>
			<div class="upcurtain"></div>
			<div class="xi"></div>
			<div class="cloud">
				<div class="cloudNext"></div>
				<div class="cloud4"></div>
				<div class="cloud3"></div>
				<div class="cloud2"></div>
				<div class="cloud1"></div>
			</div>
			<div class="dream"></div>
			<div class="slide"></div>
		</div>
	</div>
	<div class="box box5 hide">
		<div class="backgroundM1">
			<div class="mailBack"></div>
			<div class="mailHead"></div>
			<div class="content1 content">
				<div class="letter letterShow">一乌尔都魏国强无敌群多无哥屋恩稳乌尔都魏国强无敌群多无哥屋恩稳乌尔都魏国强无敌群多无哥屋恩稳乌尔都魏国强无敌群多无哥屋恩稳乌尔都魏国强无敌群多无哥屋恩稳乌尔都魏国强无敌群多无哥屋恩稳乌尔都魏国强无敌群多无哥屋恩稳乌尔都魏国强无敌群多无哥屋恩</div>
				<div class="picture pictureShow">
					<img>
				</div>
			</div>
			<div class="content2 content hide">
				<div class="letter letterShow">二乌尔都魏国强无敌群多无哥屋恩稳乌尔都魏国强无敌群多无哥屋恩稳乌尔都魏国强无敌群多无哥屋恩稳乌尔都魏国强无敌群多无哥屋恩稳乌尔都魏国强无敌群多无哥屋恩稳乌尔都魏国强无敌群多无哥屋恩稳乌尔都魏国强无敌群多无哥屋恩稳乌尔都魏国强无敌群多无哥屋恩</div>
				<div class="picture pictureShow">
					<img>
				</div>
			</div>
			<div class="makingPage hide">
				<div id="textMake" class="letterMaking letterShow"></div>
				<div class="pictureMaking pictureShow">
					<img id="pictureShow">
				</div>
				<div class="changeM pictureShow" onclick="changeM();"></div>
				<div class="writing letterShow" onclick="writing();"></div>
				<input class="input pictureShow" type="file" name="" onchange="uploads(this);"/>
			</div>
			<div class="mailFront"></div>
			<div class="making" onclick="make();"></div>
			<div class="writingPage hide">
				<textarea id="textWrite" class="text" maxlength="120"></textarea>
				<div class="hideWriting" onclick="hideWriting();"></div>
			</div>
		</div>
		<div class="tips" onclick="tips();">左右滑动切换不同模板</div>
	</div>
	<div class="pictureLoad">
		<img src="img/backgroundM2.jpg">
		<img src="img/backgroundM1.jpg">
		<img src="img/mailBackDown1.png">
		<img src="img/mailBackDown2.png">
		<img src="img/mailFront1.png">
		<img src="img/mailFront2.png">
		<img src="img/mailHead1.png">
		<img src="img/mailHead2.png">
		<img src="img/picture1.png">
		<img src="img/picture2.png">
		<img src="img/letter1.jpg">
		<img src="img/letter2.jpg">
		<img src="img/making1.png">
		<img src="img/making2.png">
		<img src="img/finish1.png">
		<img src="img/finish2.png">
	</div>
<script type="text/javascript" src="http://html2canvas.hertzen.com/dist/html2canvas.js"></script>
<script type="text/javascript" src="https://cdn.bootcss.com/jquery/1.11.2/jquery.min.js"></script>
<script type="text/javascript">
	var curbox = 1;
	var boxL = $('.box').length;
	var canTouch = true;
	var isFirst = true;
	var inside = 1;
	var outside = 2;
	var isMake = false;
	var isWrite = false;
	var nowM = 0;
	var allM = {
		backgroundM:["backgroundM1","backgroundM2"],
		changeM:["changeM1","changeM2"],
		making:["making1","making2"],
		finish:["finish1","finish2"],
		letter:["letter1","letter2"],
		mailFront:["mailFront1","mailFront2"],
		mailHead:["mailHead1","mailHead2"],
		picture:["picture1","picture2"],
		mailBack:["mailBackDown1","mailBackDown2"],
		fontColor:["color: #e3cb21;","color: #b7711b;"]
	};
	console.log(allM);
	if (localStorage.getItem('isFirst')) {
		isFirst = false;
		console.log(isFirst);
	}
	var startY , endY , diff;
	var startX , endX , diffL;
	document.body.addEventListener("touchstart", touchStart, false);
	document.body.addEventListener("touchmove", touchMove, false);
	document.body.addEventListener("touchend", touchEnd, false);
	function touchStart(e){
		var touch = e.touches[0];
		console.log(touch);
		startY = touch.clientY;
		startX = touch.clientX;
		console.log(startY);
		console.log(startX);
	}  
	function touchMove(e){
		e.preventDefault();
		var touch = e.touches[0];
		endY = touch.clientY;
		diff = endY - startY;
		endX = touch.clientX;
		diffL = endX - startX;
		console.log("竖"+diff);
		console.log("平"+diffL);
	}
	function touchEnd(e){
		console.log("ok");
		if(Math.abs(diff) > 150 && canTouch){
			if(diff > 0){
				if(curbox <= 1){
					return;
				}
				$('.box' + curbox).removeClass('inTop outTop inDown outDown hide').addClass('outDown');
				curbox--;
				$('.box' + curbox).removeClass('inTop outTop inDown outDown hide').addClass('inDown');
				
			}else{
				if(curbox >= boxL){
					return;
				}
				$('.box' + curbox).removeClass('inTop outTop inDown outDown hide').addClass('outTop');
				curbox++;
				$('.box' + curbox).removeClass('inTop outTop inDown outDown hide').addClass('inTop');
			}
			if (curbox == 5) {
				if (!isFirst) {
					$('.tips').addClass('hide');
				}
				if (!isMake) {
					$('.letter').addClass('letterShow');
					$('.picture').addClass('pictureShow');
				}else{
					$('.finish').removeClass('outIn');
				}
				if (!isWrite) {
					$('.letterMaking').removeClass('hideWrite').addClass('letterShow');
				}
				$('.making').addClass('pointNo');
				setTimeout(function(){
					$('.making').removeClass('pointNo');
				},6000);
			}
			canTouch = false;
			setTimeout(function(){
				canTouch = true;
				diff = 0;
				$('.box' + (curbox - 1) + ', .box' + (curbox + 1)).addClass('hide');
			},1000);
		}
		if (curbox >= 5 && !isMake && canTouch) {
				console.log (diffL);
				if (diffL > 0 && Math.abs(diffL) > 300) {
					console.log('准备移动')
					$('.letter').removeClass('letterShow');
					$('.picture').removeClass('pictureShow');
					$('.content'+inside).addClass('outRight');
					$('.content'+outside).removeClass('hide').addClass('inLeft');
				}
				if (diffL < 0 && Math.abs(diffL) > 300) {
					console.log('准备移动')
					$('.letter').removeClass('letterShow');
					$('.picture').removeClass('pictureShow');
					$('.content'+inside).addClass('outLeft');
					$('.content'+outside).removeClass('hide').addClass('inRight');
				}
				canTouch = false;
				if (Math.abs(diffL) > 300) {
					setTimeout(function(){
						diffL = 0;
						canTouch = true;
						$('.content'+inside).addClass('hide');
						$('.content').removeClass('outRight inLeft outLeft inRight')
						var change;
						change = inside;
						inside = outside;
						outside = change;
						console.log("里"+inside)
						console.log("外"+outside)
					},1500);
				}
			}
	}
	function tips(){
		console.log("隐藏");
		$('.tips').addClass('hide');
		localStorage.setItem("isFirst",1);
	}
	function make(){
		if (!isMake) {
			$('.letter').removeClass('letterShow');
			$('.picture').removeClass('pictureShow');
			$('.letter').addClass('letterOut');
			$('.picture').addClass('pictureOut');
			setTimeout(function(){
				$('.letter').addClass('hide');
				$('.picture').addClass('hide');
				$('.makingPage').removeClass('hide');
				$('.making').addClass('outIn');
				canTouch = true;
				setTimeout(function(){
					$('.making').removeClass('making').addClass('finish');
					isMake = true;
				},4000);
			},3000);
		}else{
			window.location.href = 'picture.html?text=' + document.getElementById('textMake').innerHTML + '&img=' + $('#pictureShow').attr('src') + '&nowM=' + nowM
		}
	}
	function writing(){
		console.log('ok');
		isWrite = !isWrite;
		if (isWrite) {
			console.log('展开');
			$('.letterMaking').removeClass('letterShow hideWrite').addClass('inWrite');
			document.getElementById('textMake').innerHTML = null;
			$('.changeM').addClass('zDown');
			setTimeout(function(){
				$('.writingPage').removeClass('hide');
				$('.letterMaking').addClass('hide');
				$('.changeM').removeClass('zDown');
			},3000);
			canTouch = false;
		}
	}
	function hideWriting(){
		console.log('ok');
		isWrite = !isWrite;
		if (!isWrite) {
			console.log('隐藏');
			console.log(document.getElementById('textMake').innerHTML);
			console.log(document.getElementById('textWrite').value);
			$('.writingPage').addClass('hide');
			$('.changeM').addClass('zDown');
			$('.letterMaking').removeClass('letterShow hide').addClass('hideWrite');
			canTouch = true;
			setTimeout(function(){
				document.getElementById('textMake').innerHTML = document.getElementById('textWrite').value;
				$('.changeM').removeClass('zDown');
			},3000);
		}
	}
	function uploads(fileDom) {
		var reader = new FileReader()
		console.log(fileDom)
		console.log(fileDom.files)
		console.log(fileDom.value)
		var file = fileDom.files[0]
		var imageType = /^image\//
		if (!imageType.test(file.type)) {
			alert('请选择正确的图片~(｀・ω・´)')
		} else {
			reader.onload = function (e) {
				console.log(e.target.result);
				$('#pictureShow').attr('src', e.target.result ); 
			}
			reader.readAsDataURL(file)
		}
	}
	function changeM(){
		nowM = (nowM+1)%2;
		console.log(nowM);
		$(".backgroundM1").attr('style', 'background: url(img/'+allM.backgroundM[nowM]+'.jpg) no-repeat;background-size: cover;background-position: center;')
		$(".mailBack").attr('style', 'background: url(img/'+allM.mailBack[nowM]+'.png) no-repeat;background-size: contain;background-position: bottom;')
		$(".mailHead").attr('style', 'background: url(img/'+allM.mailHead[nowM]+'.png) no-repeat;background-size: contain;')
		$(".letter").attr('style', 'background: url(img/'+allM.letter[nowM]+'.jpg) no-repeat;background-size: contain;')
		$(".writingPage").attr('style', 'background: url(img/'+allM.letter[nowM]+'.jpg) no-repeat;background-size: contain;')
		$(".letterMaking").attr('style', 'background: url(img/'+allM.letter[nowM]+'.jpg) no-repeat;background-size: contain;'+allM.fontColor[nowM])
		$(".text").attr('style',allM.fontColor[nowM])
		$(".picture").attr('style', 'background: url(img/'+allM.picture[nowM]+'.png) no-repeat;background-size: contain;')
		$(".pictureMaking").attr('style', 'background: url(img/'+allM.picture[nowM]+'.png) no-repeat;background-size: contain;')
		$(".making").attr('style', 'background: url(img/'+allM.making[nowM]+'.png) no-repeat;background-size: contain;')
		$(".finish").attr('style', 'background: url(img/'+allM.finish[nowM]+'.png) no-repeat;background-size: contain;')
		$(".mailFront").attr('style', 'background: url(img/'+allM.mailFront[nowM]+'.png) no-repeat;background-size: contain;background-position: bottom;')
		$(".changeM").attr('style', 'background: url(img/'+allM.changeM[nowM]+'.png) no-repeat;background-size: contain;')
	}
</script>
</body>

</html>